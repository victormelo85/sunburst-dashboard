<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sunburst — Fornecedores de lenha e cavaco - RS</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    #chart { width: 100%; height: 100vh; }
  </style>
</head>
<body>
  <div id="chart"></div>

  <script>
    // =========================
    // 1) DADOS
    // =========================
    const data = {
      name: "Caracterização de Fornecedores",
      children: [
        { name: "Perfil", children: [
          { name: "Silvicultor", value: 50 },
          { name: "Compra madeira em pé", value: 10 }
        ]},
        { name: "Tamanho Propriedade", children: [
          { name: "Pequena (<10ha)", value: 13 },
          { name: "Medio (10ha<100ha)", value: 10 },
          { name: "Grande (>100ha)", value: 7 }
        ]},
        { name: "Capacidade de Fornecimento", children: [
          { name: "Grande (> 10.000 m3/ano)", value: 13 },
          { name: "Médio (1.000 - 10.000 m3/ano)", value: 8 },
          { name: "Pouco (1-1.000 m3/ano)", value: 9 }
        ]},
        { name: "Colheita Florestal", children: [
          { name: "Mecanizada", value: 8 },
          { name: "Semimecanizada", value: 22 }
        ]},
        { name: "Fonte de Madeira", children: [
          { name: "Própria", value: 13 },
          { name: "Própria/Terceiros", value: 9 },
          { name: "Terceiros", value: 8 }
        ]}
      ]
    };

    // Paleta por tema
    const palette = {
      "Perfil": "#f28e2c",
      "Tamanho Propriedade": "#6f6f6f",
      "Capacidade de Fornecimento": "#4d87bd",
      "Colheita Florestal": "#8bc34a",
      "Fonte de Madeira": "#8b0000"
    };

    // aplica a cor do tema nas fatias filhas
    function applyColors(node){
      if(node.children){
        node.itemStyle = node.itemStyle || {};
        node.itemStyle.color = palette[node.name] || node.itemStyle.color;
        node.children.forEach(c => {
          c.itemStyle = c.itemStyle || {};
          c.itemStyle.color = palette[node.name] || c.itemStyle.color;
          applyColors(c);
        });
      }
    }
    data.children.forEach(applyColors);

    // quebra nomes longos em múltiplas linhas
    function wrapName(name, maxPerLine) {
      if (!name) return '';
      const words = String(name).split(' ');
      const lines = [];
      let cur = '';
      for (const w of words) {
        const test = (cur + ' ' + w).trim();
        if (test.length > maxPerLine) {
          if (cur) lines.push(cur.trim());
          cur = w;
        } else {
          cur = test;
        }
      }
      if (cur) lines.push(cur.trim());
      return lines.join('\n');
    }

    // =========================
    // 3) GRÁFICO
    // =========================
    const chart = echarts.init(document.getElementById('chart'));
    chart.setOption({
      title: { text: 'Caracterização de Fornecedores de lenha e cavaco - RS', left: 'center' },
      series: [{
        type: 'sunburst',
        data: data.children,
        radius: [50, '90%'],
        sort: null,

        // sem interação de clique (apenas hover)
        nodeClick: false,
        selectedMode: false,
        emphasis: { focus: 'self', blurScope: 'coordinateSystem' },

        // rótulo padrão (branco + sombra leve)
        label: {
          show: true,
          rotate: 'tangential',
          minAngle: 4,
          color: '#ffffff',
          textShadowColor: 'rgba(0,0,0,0.45)',
          textShadowBlur: 2
        },

        levels: [
          {}, // raiz

          // Anel interno (TEMAS)
          {
            r0: 50, r: 120,
            label: {
              rotate: 0,
              fontWeight: 'normal',
              fontSize: 8,
              color: '#ffffff',
              textShadowColor: 'rgba(0,0,0,0.45)',
              textShadowBlur: 2,
              overflow: 'break',
              lineHeight: 10,
              formatter: p => wrapName(p.name, 18)
            }
          },

          // Anel externo (itens)
          {
            r0: 120, r: '90%',
            label: {
              show: true,
              rotate: 'tangential',
              fontSize: 8,
              color: '#ffffff',
              textShadowColor: 'rgba(0,0,0,0.45)',
              textShadowBlur: 2,
              minAngle: 4,
              overflow: 'break',
              lineHeight: 10,
              formatter: p => wrapName(p.name, 14)
            }
          }
        ]
      }],
      tooltip: {
        trigger: 'item',
        formatter: (p) => p.treePathInfo.map(d => d.name).slice(1).join(' → ') + ': ' + p.value
      }
    });

    // segurança extra: ignora qualquer seleção após clique
    chart.on('click', function () {
      chart.dispatchAction({ type: 'downplay', seriesIndex: 0 });
    });

    window.addEventListener('resize', () => chart.resize());
  </script>
</body>
</html>
